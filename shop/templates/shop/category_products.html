{% extends "shop/base.html" %}
{% load static %}

{% block title %}{{ category.name }} - Rian Audio Sounds{% endblock %}

{% block content %}
<div class="container py-5">
  <!-- Category Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 fw-bold text-purple">{{ category.name }}</h1>
    <a href="{% url 'products' %}" class="btn btn-outline-gold btn-sm">
      View All Products
    </a>
  </div>

  <!-- Products Grid -->
  <div class="row g-4">
    {% for product in products %}
      <div class="col-md-4 col-sm-6">
        <div class="card h-100 shadow-sm d-flex flex-column product-card-hover">
          
          <!-- Image -->
          <div class="position-relative">
            {% if product.images.first %}
              <img src="{{ product.images.first.image.url }}" class="card-img-top" alt="{{ product.name }}">
            {% else %}
              <img src="{% static 'shop/img/no-image.png' %}" class="card-img-top" alt="No image">
            {% endif %}
            
            {% if product.on_sale %}
              <span class="badge bg-gold text-dark position-absolute top-0 start-0 m-2 px-3 py-2">
                SALE
              </span>
            {% endif %}
          </div>

          <!-- Body -->
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-semibold text-purple">{{ product.name }}</h5>
            <p class="card-text text-muted small flex-grow-1">
              {{ product.description|truncatewords:15 }}
            </p>
            <div>
              {% if product.on_sale %}
                <span class="text-danger fw-bold">KES {{ product.price }}</span>
                <small class="text-muted text-decoration-line-through">KES {{ product.old_price }}</small>
              {% else %}
                <span class="text-gold fw-bold">KES {{ product.price }}</span>
              {% endif %}
            </div>
          </div>

          <!-- Footer -->
          <div class="card-footer bg-white border-0 d-flex justify-content-between">
            <a href="{% url 'product_detail' product.slug %}" class="btn btn-sm btn-purple">View</a>
            <form method="post" action="{% url 'add_to_cart' product.id %}" class="d-inline-block ajax-add-to-cart">
              {% csrf_token %}
              <input type="hidden" name="quantity" value="1">
              <button type="submit" class="btn btn-sm btn-outline-gold">Add to Cart</button>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12 text-center text-muted py-5">
        <p>No products available in this category yet.</p>
      </div>
    {% endfor %}
  </div>
</div>

<!-- Hover Effect -->
<style>
  .product-card-hover {
    transition: all 0.3s ease-in-out;
    border: 1px solid transparent;
  }
  .product-card-hover:hover {
    border: 1px solid var(--purple);
    box-shadow: 0 0 15px rgba(128, 0, 128, 0.2);
    transform: translateY(-3px);
  }
</style>
{% endblock %}
