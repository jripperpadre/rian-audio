{% extends "shop/base.html" %}
{% load nav_extras %}
{% load static %}

{% block title %}Home - Rian Audio Sounds{% endblock %}

{% block content %}
<!-- Hero -->
<section class="hero-section text-white text-center d-flex align-items-center" 
  style="background: linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.6)), url('{% static "shop/img/hero-bg.jpg" %}') center/cover no-repeat; min-height: 80vh;">
  <div class="container">
    <h1 class="display-3 fw-bold mb-3">Premium Audio Systems</h1>
    <p class="lead mb-4">Experience sound like never before</p>
    <p class="mb-4">Custom Jua systems, high-performance amplifiers & premium car audio.</p>
    <!-- CTAs -->
    <a href="{% url 'products' %}" class="btn btn-shop btn-lg me-2 shadow-sm">Shop Now</a>
    <a href="https://wa.me/{{ site_config.whatsapp_number|default:'+254700000000' }}" 
       class="btn btn-success btn-lg shadow-sm" target="_blank">
       <i class="bi bi-whatsapp me-1"></i> Chat on WhatsApp
    </a>
  </div>
</section>

<!-- Featured Products -->
<section class="py-5">
  <div class="container">
    <h2 class="h3 fw-bold text-center mb-4 text-purple">Featured Products</h2>
    <div class="row g-4">
      {% for product in featured_products %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="position-relative">
            {% if product.badge_type %}
              <span class="badge bg-{{ product.badge_type }} position-absolute top-0 start-0 m-2">
                {{ product.get_badge_type_display }}
              </span>
            {% endif %}
            <div class="card shadow-sm border-0 h-100 text-center">
              <a href="{% url 'product_detail' product.slug %}">
                {% if product.main_image %}
                  <img src="{{ product.main_image.url }}" alt="{{ product.name }}"
                       class="card-img-top" style="height:200px; object-fit:cover;">
                {% else %}
                  <div class="bg-light d-flex align-items-center justify-content-center" style="height:200px;">
                    <i class="bi bi-box-seam fs-1 text-muted"></i>
                  </div>
                {% endif %}
              </a>
              <div class="card-body">
                <h5 class="fw-semibold text-dark">{{ product.name }}</h5>
                <p class="text-muted small">{{ product.category.name }}</p>
                <p class="fw-bold text-gold">
                  {{ product.price|floatformat:0 }} KES
                  {% if product.old_price %}
                    <span class="text-muted text-decoration-line-through small ms-1">
                      {{ product.old_price|floatformat:0 }} KES
                    </span>
                  {% endif %}
                </p>

                <!-- ✅ Add to cart form -->
                <form method="post" action="{% url 'add_to_cart' product.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="quantity" value="1">
                  <button type="submit" class="btn btn-shop w-100 mb-2">
                    <i class="bi bi-cart-plus me-1"></i> Add to Cart
                  </button>
                </form>

                <!-- WhatsApp help -->
                <a href="https://wa.me/{{ product.display_whatsapp|cut:'+'|cut:' ' }}" 
                   class="btn btn-success w-100" target="_blank">
                  <i class="bi bi-whatsapp me-1"></i> Help on WhatsApp
                </a>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="fallback-box text-center">
          <i class="bi bi-box-seam display-4 mb-3"></i>
          <p class="lead fw-semibold mb-0">No featured products yet. Check back soon!</p>
        </div>
      {% endfor %}
    </div>

    <!-- View All CTA -->
    <div class="text-center mt-4">
      <a href="{% url 'products' %}" class="btn btn-outline-purple">View All Products</a>
    </div>
  </div>
</section>

<!-- Categories -->
<section class="py-5 bg-light">
  <div class="container">
    <h2 class="h3 fw-bold text-center mb-4 text-purple">Shop by Category</h2>
    <div class="row g-4 justify-content-center">
      {% for category in categories %}
        <div class="col-6 col-md-3">
          <a href="{% url 'category_products' category.slug %}" class="text-decoration-none">
            <div class="card shadow-sm border-0 h-100 text-center hover-shadow product-card">
              {% if category.image %}
                <img src="{{ category.image.url }}" alt="{{ category.name }}" 
                     class="card-img-top" style="height:180px; object-fit:cover;" loading="lazy">
              {% else %}
                <div class="bg-purple d-flex align-items-center justify-content-center" 
                     style="height:180px;">
                  <i class="bi bi-speaker fs-1 text-white"></i>
                </div>
              {% endif %}
              <div class="card-body py-3">
                <h5 class="fw-semibold text-purple">{{ category.name }}</h5>
              </div>
            </div>
          </a>
        </div>
      {% empty %}
        <div class="fallback-box text-center">
          <i class="bi bi-grid display-4 mb-3"></i>
          <p class="lead fw-semibold mb-0">No categories available yet.</p>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Testimonials -->
<!-- Testimonials -->
<section class="py-5">
  <div class="container">
    <h2 class="h3 fw-bold text-center mb-5">What Customers Say</h2>
    {% if testimonials %}
      <div class="row g-4 justify-content-center">
        {% for t in testimonials %}
          <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-sm border-0 rounded-3 text-center p-4 h-100 
              {% cycle 'bg-success text-white' 'bg-info text-white' 'bg-warning text-dark' 'bg-primary text-white' as card_colors %}">
              
              {% if t.avatar %}
                <img src="{{ t.avatar.url }}" alt="{{ t.name }}"
                     class="rounded-circle mx-auto mb-3 border border-light shadow-sm"
                     style="width: 70px; height: 70px; object-fit: cover;">
              {% else %}
                <div class="rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center fw-bold shadow-sm 
                     {% cycle 'bg-dark text-white' 'bg-dark text-white' 'bg-dark text-white' 'bg-light text-dark' %}"
                     style="width: 70px; height: 70px; font-size: 1.25rem;">
                  {{ t.name|first|upper }}
                </div>
              {% endif %}

              <p class="fst-italic small">"{{ t.message }}"</p>
              <h6 class="fw-semibold mt-2">{{ t.name }}</h6>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center">
        <i class="bi bi-chat-left-quote display-4 mb-3 text-muted"></i>
        <p class="lead fw-semibold mb-0">No testimonials yet. Be the first to share your experience!</p>
      </div>
    {% endif %}
    <div class="text-center mt-4">
      <a href="{% url 'testimonials' %}" class="btn btn-primary">See All Testimonials</a>
    </div>
  </div>
</section>


<!-- ✅ Newsletter CTA (goes to newsletter page) -->
<section class="py-5 bg-purple text-white text-center">
  <div class="container">
    <h2 class="h3 fw-bold text-gold">Stay Updated</h2>
    <a href="{% url 'newsletter_page' %}" class="btn btn-shop btn-lg mt-3">Join Our Newsletter</a>
    <p class="small mt-3 text-light">0 spam. Unsubscribe anytime.</p>
  </div>
</section>

<!-- Floating WhatsApp -->
<a href="https://wa.me/{{ site_config.whatsapp_number|default:'+254700000000' }}" 
   class="whatsapp-float" target="_blank" aria-label="Chat on WhatsApp">
  <i class="bi bi-whatsapp"></i>
</a>
{% endblock %}
