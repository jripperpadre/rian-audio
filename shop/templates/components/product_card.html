<div class="card product-card shadow-sm border-0 h-100 rounded-4">
  <div class="position-relative overflow-hidden rounded-top-4">
    <!-- Badge -->
    {% if product.badge_type %}
      <span class="badge bg-{{ product.badge_type }} position-absolute top-0 start-0 m-2 px-3 py-2 rounded-pill shadow-sm">
        {{ product.get_badge_type_display }}
      </span>
    {% endif %}

    <!-- Product Image -->
    {% if product.images.first %}
      <img src="{{ product.images.first.image.url }}" 
           alt="{{ product.name }}" 
           class="card-img-top rounded-top-4 product-img" 
           style="height:220px; object-fit:cover;" loading="lazy">
    {% else %}
      <div class="bg-light d-flex align-items-center justify-content-center rounded-top-4" 
           style="height:220px;">
        <i class="bi bi-speaker fs-1 text-muted"></i>
      </div>
    {% endif %}
  </div>

  <!-- Card Body -->
  <div class="card-body d-flex flex-column p-3">
    <!-- Title -->
    <h5 class="card-title fw-bold text-purple text-truncate mb-1">
      {{ product.name }}
    </h5>

    <!-- Description -->
    <p class="card-text small text-muted text-truncate mb-2">
      {{ product.description|truncatechars:60 }}
    </p>

    <!-- Price -->
    <div class="mb-2">
      {% if product.old_price and product.old_price > product.price %}
        <span class="fw-bold text-gold">KES {{ product.price }}</span>
        <span class="text-muted text-decoration-line-through ms-1">
          KES {{ product.old_price }}
        </span>
      {% else %}
        <span class="fw-bold text-purple">KES {{ product.price }}</span>
      {% endif %}
    </div>

    <!-- Stock -->
    {% if product.stock > 0 %}
      <span class="badge bg-success mb-3">In Stock</span>
    {% else %}
      <span class="badge bg-danger mb-3">Out of Stock</span>
    {% endif %}

    <!-- Buttons -->
    <div class="mt-auto d-flex flex-column gap-2">
      <a href="{% url 'product_detail' product.slug %}" 
         class="btn btn-outline-purple btn-sm rounded-3">
        View Details
      </a>

      {% if product.stock > 0 %}
        <button class="btn btn-shop btn-sm rounded-3 add-to-cart-btn" 
                data-product-id="{{ product.id }}">
          <i class="bi bi-cart-plus me-1"></i> Add to Cart
        </button>
      {% else %}
        <button class="btn btn-secondary btn-sm rounded-3" disabled>
          <i class="bi bi-cart-x me-1"></i> Sold Out
        </button>
      {% endif %}
    </div>
  </div>
</div>
